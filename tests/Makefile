# Makefile created by mkmf $Id: mkmf,v 18.0 2010/03/02 23:26:08 fms Exp $
# Makefile to build the prototype test model, autogenerated, slightly edited
#
# ------------ compiler selection ----------------------------------------------
# ---[ GNU vs. Solaris Studio vs. Intel :: vs other compilers ]-----------------
FC=gfortran
#FC=f95
#FC=/home/budaev/bin/solarisstudio12.4/bin/f95
#FC=ifort
# ------------ compiler flags --------------------------------------------------
# options
STATIC=-static-libgfortran -static
TRAPS=-ffpe-trap=zero,invalid,overflow,underflow
RCHECKS=-Wall -fbounds-check
# compiler flags
FFLAGS=-g $(STATIC) $(TRAPS)
# ------------------------------------------------------------------------------
# Determine platform type and SVN revision number, possibly for
# setting working scratch directory as in the older build script
# NOTE: Force English with set LANG=en_US for correct SVN messages
PLATFORM = $(shell uname)
SVN_VER = $(shell svn info | grep Revision: | cut -d " " -f 2)
# ------------------------------------------------------------------------------

.DEFAULT:
	-echo $@ does not exist.
all: MODEL_PROTO
BASE_CSV_IO.o: ../BASE_CSV_IO.f90
	$(FC) $(FFLAGS) $(OTHERFLAGS) -c	../BASE_CSV_IO.f90
BASE_LOGGER.o: ../BASE_LOGGER.f90
	$(FC) $(FFLAGS) $(OTHERFLAGS) -c	../BASE_LOGGER.f90
BASE_UTILS.o: ../BASE_UTILS.f90
	$(FC) $(FFLAGS) $(OTHERFLAGS) -c	../BASE_UTILS.f90
MODEL_PROTO.o: ./MODEL_PROTO.f90 BASE_LOGGER.o BASE_UTILS.o BASE_CSV_IO.o
	$(FC) $(FFLAGS) $(OTHERFLAGS) -c	./MODEL_PROTO.f90
./BASE_LOGGER.f90: ../BASE_LOGGER.f90
	cp ../BASE_LOGGER.f90 .
./BASE_CSV_IO.f90: ../BASE_CSV_IO.f90
	cp ../BASE_CSV_IO.f90 .
./BASE_UTILS.f90: ../BASE_UTILS.f90
	cp ../BASE_UTILS.f90 .
SRC = ../BASE_CSV_IO.f90 ../BASE_UTILS.f90 ./MODEL_PROTO.f90 ../BASE_LOGGER.f90
OBJ = BASE_CSV_IO.o BASE_UTILS.o MODEL_PROTO.o BASE_LOGGER.o
OFF = ../BASE_LOGGER.f90 ../BASE_CSV_IO.f90 ../BASE_UTILS.f90
clean: neat
	-rm -f .MODEL_PROTO.cppdefs $(OBJ) MODEL_PROTO *.csv *.log *.mod *.o
neat:
	-rm -f $(TMPFILES)
localize: $(OFF)
	cp $(OFF) .
TAGS: $(SRC)
	etags $(SRC)
tags: $(SRC)
	ctags $(SRC)
MODEL_PROTO: $(OBJ)
	@echo ----------------------------------------
	@echo "Building for platform :: '$(PLATFORM)'"
	@echo "Build SVN revision    :: '$(SVN_VER)'"
	@echo ----------------------------------------
	$(FC) $(OBJ) -o MODEL_PROTO  $(LDFLAGS)
lib: $(OBJ)
	$(FC) -shared -O2 $(SRC) -o lib_hedutils.so -fPIC
run: MODEL_PROTO
	echo "Build platform is '$(PLATFORM)'"
	./MODEL_PROTO
